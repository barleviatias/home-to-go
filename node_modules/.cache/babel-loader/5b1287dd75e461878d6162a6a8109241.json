{"ast":null,"code":"import { storageService } from './asyncStorageService'; // import axios from 'axios'\n// import { httpService } from './http.service'\n// const SCORE_FOR_REVIEW = 10\n// const IMG_API_KEY = '20031048-f5c2a8cb9ae058a58da123891'\n\nexport const stayService = {\n  query,\n  getById,\n  remove,\n  update,\n  add,\n  getTopRatedStays,\n  getNearbyStays,\n  getHostStays // getStayImage,\n  // getPriceData,\n  // getDateData\n\n};\nwindow.stayService = stayService; // Note: due to async, must run one by one...\n// stayService.signup({fullname: 'Puki Norma', stayname: 'stay1', password:'123',score: 100, isAdmin: false})\n// stayService.signup({fullname: 'Master Adminov', stayname: 'admin', password:'123', score: 100, isAdmin: true})\n// stayService.signup({fullname: 'Muki G', stayname: 'muki', password:'123', score: 100})\n\nfunction query(trip) {\n  return storageService.query('stay', trip); // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\n  // return httpService.get(`stay${queryStr}`)\n}\n\nfunction getById(stayId) {\n  return storageService.get('stay', stayId); // return httpService.get(`stay/${stayId}`)\n}\n\nfunction remove(stayId) {\n  return storageService.remove('stay', stayId); // return httpService.delete(`stay/${stayId}`)\n}\n\nasync function update(stay) {\n  return storageService.put('stay', stay); // return await httpService.put(`stay/${stay._id}`, stay)\n  // Handle case in which admin updates other stay's details\n  // if (getLoggedinStay()._id === stay._id) _saveLocalStay(stay)\n}\n\nasync function add(stay) {\n  return storageService.post('stay', stay); // stay.imgUrl = await getStayImage(stay.name)\n  // stay.msgs = []\n  // return await httpService.post(`stay`, stay)\n  // Handle case in which admin updates other stay's details\n  // if (getLoggedinStay()._id === stay._id) _saveLocalStay(stay)\n} // async function getTopRatedStays(stays) {\n//     stays = stays.map(stay => {\n//         stay.avgRate = _getRate(stay);\n//         return stay\n//     })\n//     stays.sort(function (a, b) {\n//         return b.avgRate - a.avgRate\n//     })\n//     return stays.slice(0, 4)\n//     // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\n//     // return httpService.get(`stay${queryStr}`)\n// }\n\n\nasync function getTopRatedStays() {\n  var stays = await storageService.query('stay');\n  stays = stays.map(stay => {\n    stay.avgRate = _getRate(stay);\n    return stay;\n  });\n  stays.sort(function (a, b) {\n    return b.avgRate - a.avgRate;\n  });\n  return stays.slice(0, 4); // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\n  // return httpService.get(`stay${queryStr}`)\n}\n\nfunction _getRate(stay) {\n  const rates = stay.reviews.map(review => review.avgRate);\n  const sum = rates.reduce((acc, rate) => {\n    acc += rate;\n    return acc;\n  }, 0);\n  return sum / rates.length;\n}\n\nasync function getNearbyStays(location) {\n  var stays = await storageService.query('stay');\n  stays = stays.filter(stay => {\n    return stay.loc.address.toUpperCase().includes(location.toUpperCase());\n  });\n  return stays.slice(0, 4); // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\n  // return httpService.get(`stay${queryStr}`)\n}\n\nasync function getHostStays(userId) {\n  var stays = await storageService.query('stay');\n  stays = stays.filter(stay => {\n    return stay.host._id === userId;\n  });\n  return stays; // stays = stays.filter(stay => {\n  //     return stay.loc.address.toUpperCase().includes(location.toUpperCase())\n  // })\n  // return stays.slice(0, 4)\n  // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\n  // return httpService.get(`stay${queryStr}`)\n}","map":{"version":3,"sources":["C:/Users/Bar-PC/Desktop/sprint 4/src/services/stay-service.js"],"names":["storageService","stayService","query","getById","remove","update","add","getTopRatedStays","getNearbyStays","getHostStays","window","trip","stayId","get","stay","put","post","stays","map","avgRate","_getRate","sort","a","b","slice","rates","reviews","review","sum","reduce","acc","rate","length","location","filter","loc","address","toUpperCase","includes","userId","host","_id"],"mappings":"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","sourcesContent":["import { storageService } from './asyncStorageService'\r\n\r\n// import axios from 'axios'\r\n// import { httpService } from './http.service'\r\n// const SCORE_FOR_REVIEW = 10\r\n// const IMG_API_KEY = '20031048-f5c2a8cb9ae058a58da123891'\r\n\r\nexport const stayService = {\r\n    query,\r\n    getById,\r\n    remove,\r\n    update,\r\n    add,\r\n    getTopRatedStays,\r\n    getNearbyStays,\r\n    getHostStays\r\n    // getStayImage,\r\n    // getPriceData,\r\n    // getDateData\r\n}\r\n\r\nwindow.stayService = stayService\r\n// Note: due to async, must run one by one...\r\n// stayService.signup({fullname: 'Puki Norma', stayname: 'stay1', password:'123',score: 100, isAdmin: false})\r\n// stayService.signup({fullname: 'Master Adminov', stayname: 'admin', password:'123', score: 100, isAdmin: true})\r\n// stayService.signup({fullname: 'Muki G', stayname: 'muki', password:'123', score: 100})\r\n\r\nfunction query(trip) {\r\n    return storageService.query('stay', trip)\r\n\r\n    // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\r\n    // return httpService.get(`stay${queryStr}`)\r\n}\r\n\r\nfunction getById(stayId) {\r\n    return storageService.get('stay', stayId)\r\n    // return httpService.get(`stay/${stayId}`)\r\n}\r\n\r\nfunction remove(stayId) {\r\n    return storageService.remove('stay', stayId)\r\n    // return httpService.delete(`stay/${stayId}`)\r\n}\r\n\r\nasync function update(stay) {\r\n    return storageService.put('stay', stay)\r\n    // return await httpService.put(`stay/${stay._id}`, stay)\r\n    // Handle case in which admin updates other stay's details\r\n    // if (getLoggedinStay()._id === stay._id) _saveLocalStay(stay)\r\n}\r\n\r\nasync function add(stay) {\r\n    return storageService.post('stay', stay)\r\n    // stay.imgUrl = await getStayImage(stay.name)\r\n    // stay.msgs = []\r\n    // return await httpService.post(`stay`, stay)\r\n    // Handle case in which admin updates other stay's details\r\n    // if (getLoggedinStay()._id === stay._id) _saveLocalStay(stay)\r\n}\r\n\r\n\r\n\r\n// async function getTopRatedStays(stays) {\r\n//     stays = stays.map(stay => {\r\n//         stay.avgRate = _getRate(stay);\r\n//         return stay\r\n//     })\r\n//     stays.sort(function (a, b) {\r\n//         return b.avgRate - a.avgRate\r\n//     })\r\n//     return stays.slice(0, 4)\r\n//     // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\r\n//     // return httpService.get(`stay${queryStr}`)\r\n// }\r\nasync function getTopRatedStays() {\r\n    var stays = await storageService.query('stay')\r\n    stays = stays.map(stay => {\r\n        stay.avgRate = _getRate(stay);\r\n        return stay\r\n    })\r\n    stays.sort(function (a, b) {\r\n        return b.avgRate - a.avgRate\r\n    })\r\n    return stays.slice(0, 4)\r\n    // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\r\n    // return httpService.get(`stay${queryStr}`)\r\n}\r\n\r\nfunction _getRate(stay) {\r\n    const rates = stay.reviews.map(review => review.avgRate)\r\n    const sum = rates.reduce((acc, rate) => {\r\n        acc += rate\r\n        return acc\r\n    }, 0)\r\n    return sum / rates.length\r\n}\r\n\r\nasync function getNearbyStays(location) {\r\n    var stays = await storageService.query('stay')\r\n    stays = stays.filter(stay => {\r\n        return stay.loc.address.toUpperCase().includes(location.toUpperCase())\r\n    })\r\n    return stays.slice(0, 4)\r\n    // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\r\n    // return httpService.get(`stay${queryStr}`)\r\n}\r\n\r\nasync function getHostStays(userId) {\r\n    var stays = await storageService.query('stay')\r\n    stays = stays.filter(stay => {\r\n        return stay.host._id === userId\r\n    })\r\n    return stays\r\n    // stays = stays.filter(stay => {\r\n    //     return stay.loc.address.toUpperCase().includes(location.toUpperCase())\r\n    // })\r\n    // return stays.slice(0, 4)\r\n    // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\r\n    // return httpService.get(`stay${queryStr}`)\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}