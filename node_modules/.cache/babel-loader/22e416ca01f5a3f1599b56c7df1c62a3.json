{"ast":null,"code":"import { storageService } from './asyncStorageService'; // import axios from 'axios'\n// import { httpService } from './http.service'\n// const SCORE_FOR_REVIEW = 10\n// const IMG_API_KEY = '20031048-f5c2a8cb9ae058a58da123891'\n\nexport const stayService = {\n  query,\n  getById,\n  remove,\n  update,\n  add,\n  getTopRatedStays,\n  getNearbyStays,\n  getHostStays // getStayImage,\n  // getPriceData,\n  // getDateData\n\n};\nwindow.stayService = stayService; // Note: due to async, must run one by one...\n// stayService.signup({fullname: 'Puki Norma', stayname: 'stay1', password:'123',score: 100, isAdmin: false})\n// stayService.signup({fullname: 'Master Adminov', stayname: 'admin', password:'123', score: 100, isAdmin: true})\n// stayService.signup({fullname: 'Muki G', stayname: 'muki', password:'123', score: 100})\n\nfunction query(trip) {\n  return storageService.query('stay', trip); // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\n  // return httpService.get(`stay${queryStr}`)\n}\n\nfunction getById(stayId) {\n  return storageService.get('stay', stayId); // return httpService.get(`stay/${stayId}`)\n}\n\nfunction remove(stayId) {\n  return storageService.remove('stay', stayId); // return httpService.delete(`stay/${stayId}`)\n}\n\nasync function update(stay) {\n  return storageService.put('stay', stay); // return await httpService.put(`stay/${stay._id}`, stay)\n  // Handle case in which admin updates other stay's details\n  // if (getLoggedinStay()._id === stay._id) _saveLocalStay(stay)\n}\n\nasync function add(stay) {\n  const currStay = {\n    \"name\": stay.name,\n    \"imgUrls\": [\"https://a0.muscache.com/im/pictures/bd67daca-84a4-44e9-952d-11162ba76242.jpg?im_w=1200\", \"https://a0.muscache.com/im/pictures/533919e9-d77c-4dfc-94a5-3b71d6c41792.jpg?im_w=720\", \"https://a0.muscache.com/im/pictures/miso/Hosting-4869137/original/179b4e72-c3ed-4198-b274-bbc4c67276f2.jpeg?im_w=720\", \"https://a0.muscache.com/im/pictures/miso/Hosting-4869137/original/efaab6c2-f21a-40aa-a32a-a37b08711af4.jpeg?im_w=720\", \"https://a0.muscache.com/im/pictures/miso/Hosting-4869137/original/e5a8c40e-f26b-45fb-84c2-55845256e963.jpeg?im_w=720\"],\n    \"price\": stay.price,\n    \"desc\": stay.desc,\n    \"capacity\": 8,\n    \"favorites\": [{\n      \"userId\": \"u109\"\n    }],\n    \"amenities\": getAmeneties(stay.amenities),\n    \"stayType\": \"entire place\",\n    \"propertyType\": \"loft\",\n    \"host\": {\n      \"_id\": \"u101\",\n      \"fullname\": \"Mor Levi\",\n      \"imgUrl\": \"https://randomuser.me/api/portraits/men/1.jpg\"\n    },\n    \"loc\": {\n      \"country\": \"France\",\n      \"countryCode\": \"PT\",\n      \"address\": \"Paris, France\",\n      \"lat\": -8.61308,\n      \"lng\": 41.1413\n    },\n    \"reviews\": []\n  };\n  return storageService.post('stay', currStay); // stay.imgUrl = await getStayImage(stay.name)\n  // stay.msgs = []\n  // return await httpService.post(`stay`, stay)\n  // Handle case in which admin updates other stay's details\n  // if (getLoggedinStay()._id === stay._id) _saveLocalStay(stay)\n} // async function getTopRatedStays(stays) {\n//     stays = stays.map(stay => {\n//         stay.avgRate = _getRate(stay);\n//         return stay\n//     })\n//     stays.sort(function (a, b) {\n//         return b.avgRate - a.avgRate\n//     })\n//     return stays.slice(0, 4)\n//     // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\n//     // return httpService.get(`stay${queryStr}`)\n// }\n\n\nasync function getTopRatedStays() {\n  var stays = await storageService.query('stay');\n  stays = stays.map(stay => {\n    stay.avgRate = _getRate(stay);\n    return stay;\n  });\n  stays.sort(function (a, b) {\n    return b.avgRate - a.avgRate;\n  });\n  return stays.slice(0, 4); // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\n  // return httpService.get(`stay${queryStr}`)\n}\n\nfunction _getRate(stay) {\n  const rates = stay.reviews.map(review => review.avgRate);\n  const sum = rates.reduce((acc, rate) => {\n    acc += rate;\n    return acc;\n  }, 0);\n  return sum / rates.length;\n}\n\nasync function getNearbyStays(location) {\n  var stays = await storageService.query('stay');\n  stays = stays.filter(stay => {\n    return stay.loc.address.toUpperCase().includes(location.toUpperCase());\n  });\n  return stays.slice(0, 4); // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\n  // return httpService.get(`stay${queryStr}`)\n}\n\nasync function getHostStays(userId) {\n  var stays = await storageService.query('stay');\n  stays = stays.filter(stay => {\n    return stay.host._id === userId;\n  });\n  return stays; // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\n  // return httpService.get(`stay${queryStr}`)\n}\n\nfunction getAmeneties(amenities) {\n  const currAmenities = [];\n\n  for (const key in amenities) {\n    if (amenities[key]) {\n      currAmenities.push(key);\n    }\n  }\n\n  console.log('currAmenities', currAmenities);\n  return currAmenities;\n}","map":{"version":3,"sources":["C:/Users/Bar-PC/Desktop/sprint 4/src/services/stay-service.js"],"names":["storageService","stayService","query","getById","remove","update","add","getTopRatedStays","getNearbyStays","getHostStays","window","trip","stayId","get","stay","put","currStay","name","price","desc","getAmeneties","amenities","post","stays","map","avgRate","_getRate","sort","a","b","slice","rates","reviews","review","sum","reduce","acc","rate","length","location","filter","loc","address","toUpperCase","includes","userId","host","_id","currAmenities","key","push","console","log"],"mappings":"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","sourcesContent":["import { storageService } from './asyncStorageService'\r\n\r\n// import axios from 'axios'\r\n// import { httpService } from './http.service'\r\n// const SCORE_FOR_REVIEW = 10\r\n// const IMG_API_KEY = '20031048-f5c2a8cb9ae058a58da123891'\r\n\r\nexport const stayService = {\r\n    query,\r\n    getById,\r\n    remove,\r\n    update,\r\n    add,\r\n    getTopRatedStays,\r\n    getNearbyStays,\r\n    getHostStays\r\n    // getStayImage,\r\n    // getPriceData,\r\n    // getDateData\r\n}\r\n\r\nwindow.stayService = stayService\r\n// Note: due to async, must run one by one...\r\n// stayService.signup({fullname: 'Puki Norma', stayname: 'stay1', password:'123',score: 100, isAdmin: false})\r\n// stayService.signup({fullname: 'Master Adminov', stayname: 'admin', password:'123', score: 100, isAdmin: true})\r\n// stayService.signup({fullname: 'Muki G', stayname: 'muki', password:'123', score: 100})\r\n\r\nfunction query(trip) {\r\n    return storageService.query('stay', trip)\r\n\r\n    // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\r\n    // return httpService.get(`stay${queryStr}`)\r\n}\r\n\r\nfunction getById(stayId) {\r\n    return storageService.get('stay', stayId)\r\n    // return httpService.get(`stay/${stayId}`)\r\n}\r\n\r\nfunction remove(stayId) {\r\n    return storageService.remove('stay', stayId)\r\n    // return httpService.delete(`stay/${stayId}`)\r\n}\r\n\r\nasync function update(stay) {\r\n    return storageService.put('stay', stay)\r\n    // return await httpService.put(`stay/${stay._id}`, stay)\r\n    // Handle case in which admin updates other stay's details\r\n    // if (getLoggedinStay()._id === stay._id) _saveLocalStay(stay)\r\n}\r\n\r\nasync function add(stay) {\r\n\r\n    const currStay ={\r\n        \"name\": stay.name,\r\n        \"imgUrls\": [\r\n            \"https://a0.muscache.com/im/pictures/bd67daca-84a4-44e9-952d-11162ba76242.jpg?im_w=1200\",\r\n            \"https://a0.muscache.com/im/pictures/533919e9-d77c-4dfc-94a5-3b71d6c41792.jpg?im_w=720\",\r\n            \"https://a0.muscache.com/im/pictures/miso/Hosting-4869137/original/179b4e72-c3ed-4198-b274-bbc4c67276f2.jpeg?im_w=720\",\r\n            \"https://a0.muscache.com/im/pictures/miso/Hosting-4869137/original/efaab6c2-f21a-40aa-a32a-a37b08711af4.jpeg?im_w=720\",\r\n            \"https://a0.muscache.com/im/pictures/miso/Hosting-4869137/original/e5a8c40e-f26b-45fb-84c2-55845256e963.jpeg?im_w=720\"\r\n        ],\r\n        \"price\": stay.price,\r\n        \"desc\": stay.desc,\r\n        \"capacity\": 8,\r\n        \"favorites\": [\r\n            {\r\n                \"userId\": \"u109\"\r\n            }\r\n        ],\r\n        \"amenities\": getAmeneties(stay.amenities)\r\n        ,\r\n        \"stayType\": \"entire place\",\r\n        \"propertyType\": \"loft\",\r\n        \"host\": {\r\n            \"_id\": \"u101\",\r\n            \"fullname\": \"Mor Levi\",\r\n            \"imgUrl\": \"https://randomuser.me/api/portraits/men/1.jpg\"\r\n        },\r\n        \"loc\": {\r\n            \"country\": \"France\",\r\n            \"countryCode\": \"PT\",\r\n            \"address\": \"Paris, France\",\r\n            \"lat\": -8.61308,\r\n            \"lng\": 41.1413\r\n        },\r\n        \"reviews\": []\r\n            }\r\n    \r\n    return storageService.post('stay', currStay)\r\n    // stay.imgUrl = await getStayImage(stay.name)\r\n    // stay.msgs = []\r\n    // return await httpService.post(`stay`, stay)\r\n    // Handle case in which admin updates other stay's details\r\n    // if (getLoggedinStay()._id === stay._id) _saveLocalStay(stay)\r\n}\r\n\r\n\r\n\r\n// async function getTopRatedStays(stays) {\r\n//     stays = stays.map(stay => {\r\n//         stay.avgRate = _getRate(stay);\r\n//         return stay\r\n//     })\r\n//     stays.sort(function (a, b) {\r\n//         return b.avgRate - a.avgRate\r\n//     })\r\n//     return stays.slice(0, 4)\r\n//     // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\r\n//     // return httpService.get(`stay${queryStr}`)\r\n// }\r\nasync function getTopRatedStays() {\r\n    var stays = await storageService.query('stay')\r\n    stays = stays.map(stay => {\r\n        stay.avgRate = _getRate(stay);\r\n        return stay\r\n    })\r\n    stays.sort(function (a, b) {\r\n        return b.avgRate - a.avgRate\r\n    })\r\n    return stays.slice(0, 4)\r\n    // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\r\n    // return httpService.get(`stay${queryStr}`)\r\n}\r\n\r\nfunction _getRate(stay) {\r\n    const rates = stay.reviews.map(review => review.avgRate)\r\n    const sum = rates.reduce((acc, rate) => {\r\n        acc += rate\r\n        return acc\r\n    }, 0)\r\n    return sum / rates.length\r\n}\r\n\r\nasync function getNearbyStays(location) {\r\n    var stays = await storageService.query('stay')\r\n    stays = stays.filter(stay => {\r\n        return stay.loc.address.toUpperCase().includes(location.toUpperCase())\r\n    })\r\n    return stays.slice(0, 4)\r\n    // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\r\n    // return httpService.get(`stay${queryStr}`)\r\n}\r\n\r\nasync function getHostStays(userId) {\r\n    var stays = await storageService.query('stay')\r\n    stays = stays.filter(stay => {\r\n        return stay.host._id === userId\r\n    })\r\n    return stays\r\n   \r\n    // var queryStr = `?availability=${filterBy.availability}&searchTxt=${filterBy.searchTxt}&sortBy=${filterBy.sortBy}&type=${filterBy.type}`\r\n    // return httpService.get(`stay${queryStr}`)\r\n}\r\n\r\nfunction getAmeneties(amenities){\r\n    const currAmenities=[]\r\n    for (const key in amenities){\r\n        if (amenities[key]){\r\n            currAmenities.push(key)\r\n        }\r\n    } \r\n    console.log('currAmenities',currAmenities);\r\n    return currAmenities\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}