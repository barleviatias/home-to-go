{"ast":null,"code":"import user from '../data/user.json';\nimport stay from '../data/stay.json';\nimport order from '../data/order.json';\nexport const storageService = {\n  query,\n  get,\n  post,\n  put,\n  remove\n};\nloadDB();\n\nfunction loadDB() {\n  var userDB = JSON.parse(localStorage.getItem('user')) || [];\n  var stayDB = JSON.parse(localStorage.getItem('stay')) || [];\n  var orderDB = JSON.parse(localStorage.getItem('order')) || [];\n\n  if (!userDB || !userDB.length) {\n    _save('user', user);\n  }\n\n  if (!stayDB || !stayDB.length) {\n    _save('stay', stay);\n  }\n\n  if (!orderDB || !orderDB.length) {\n    _save('order', order);\n  }\n}\n\nfunction query(entityType, trip = {\n  guests: {\n    adults: 0,\n    kids: 0\n  },\n  loc: {\n    address: ''\n  },\n  time: {\n    checkIn: '',\n    checkOut: ''\n  }\n}, user = null) {\n  var entities = JSON.parse(localStorage.getItem(entityType)) || [];\n\n  if (entityType === 'stay') {\n    if (user) {}\n\n    entities = _filterByTripInfo(entities, trip);\n  } // if (entityType === 'whishlist') entities = _filterByWhishList(entities, trip)\n\n\n  return Promise.resolve(entities);\n}\n\nfunction _filterByTripInfo(entities, {\n  loc,\n  guests\n}) {\n  const address = loc.address.toUpperCase();\n  const capacity = guests.adults + guests.kids;\n  var filteredEntities = entities.filter(entitie => {\n    return entitie.loc.address.toUpperCase().includes(address) && capacity <= entitie.capacity;\n  });\n  return filteredEntities;\n}\n\nfunction _filterByWhishList(entities, {\n  loc,\n  guests\n}) {\n  const address = loc.address.toUpperCase();\n  const capacity = guests.adults + guests.kids;\n  var filteredEntities = entities.filter(entitie => {\n    return entitie.loc.address.toUpperCase().includes(address) && capacity <= entitie.capacity;\n  });\n  return filteredEntities;\n}\n\nfunction get(entityType, entityId) {\n  return query(entityType).then(entities => entities.find(entity => entity._id === entityId));\n}\n\nfunction post(entityType, newEntity) {\n  newEntity._id = _makeId();\n  return query(entityType).then(entities => {\n    entities.push(newEntity);\n\n    _save(entityType, entities);\n\n    return newEntity;\n  });\n}\n\nfunction put(entityType, updatedEntity) {\n  return query(entityType).then(entities => {\n    const idx = entities.findIndex(entity => entity._id === updatedEntity._id);\n    entities.splice(idx, 1, updatedEntity);\n\n    _save(entityType, entities);\n\n    return updatedEntity;\n  });\n}\n\nfunction remove(entityType, entityId) {\n  return query(entityType).then(entities => {\n    const idx = entities.findIndex(entity => entity._id === entityId);\n    entities.splice(idx, 1);\n\n    _save(entityType, entities);\n  });\n}\n\nfunction _save(entityType, entities) {\n  localStorage.setItem(entityType, JSON.stringify(entities));\n}\n\nfunction _makeId(length = 5) {\n  var text = '';\n  var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n  for (var i = 0; i < length; i++) {\n    text += possible.charAt(Math.floor(Math.random() * possible.length));\n  }\n\n  return text;\n}","map":{"version":3,"sources":["C:/Users/Bar-PC/Desktop/sprint 4/src/services/asyncStorageService.js"],"names":["user","stay","order","storageService","query","get","post","put","remove","loadDB","userDB","JSON","parse","localStorage","getItem","stayDB","orderDB","length","_save","entityType","trip","guests","adults","kids","loc","address","time","checkIn","checkOut","entities","_filterByTripInfo","Promise","resolve","toUpperCase","capacity","filteredEntities","filter","entitie","includes","_filterByWhishList","entityId","then","find","entity","_id","newEntity","_makeId","push","updatedEntity","idx","findIndex","splice","setItem","stringify","text","possible","i","charAt","Math","floor","random"],"mappings":"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","sourcesContent":["import user from '../data/user.json'\r\nimport stay from '../data/stay.json'\r\nimport order from '../data/order.json'\r\n\r\nexport const storageService = {\r\n    query,\r\n    get,\r\n    post,\r\n    put,\r\n    remove\r\n}\r\n\r\nloadDB()\r\n\r\nfunction loadDB() {\r\n    var userDB = JSON.parse(localStorage.getItem('user')) || []\r\n    var stayDB = JSON.parse(localStorage.getItem('stay')) || []\r\n    var orderDB = JSON.parse(localStorage.getItem('order')) || []\r\n\r\n    if (!userDB || !userDB.length) {\r\n        _save('user', user)\r\n    }\r\n    if (!stayDB || !stayDB.length) {\r\n        _save('stay', stay)\r\n    }\r\n    if (!orderDB || !orderDB.length) {\r\n        _save('order', order)\r\n    }\r\n}\r\n\r\nfunction query(entityType , trip = { guests: { adults: 0, kids: 0}, loc: { address: '' }, time: { checkIn: '', checkOut: '' } },user=null) {\r\n    var entities = JSON.parse(localStorage.getItem(entityType)) || []\r\n    if (entityType === 'stay'){\r\n        if(user){\r\n\r\n        }\r\n        entities = _filterByTripInfo(entities, trip)\r\n        \r\n    } \r\n    // if (entityType === 'whishlist') entities = _filterByWhishList(entities, trip)\r\n    return Promise.resolve(entities)\r\n}\r\n\r\nfunction _filterByTripInfo(entities, { loc, guests }) {\r\n\r\n    const address = loc.address.toUpperCase();\r\n    const capacity = guests.adults + guests.kids;\r\n    var filteredEntities = entities.filter((entitie) => {\r\n        return entitie.loc.address.toUpperCase().includes(address) && capacity <= entitie.capacity;\r\n    })\r\n    return filteredEntities\r\n}\r\nfunction _filterByWhishList(entities, { loc, guests }) {\r\n\r\n    const address = loc.address.toUpperCase();\r\n    const capacity = guests.adults + guests.kids;\r\n    var filteredEntities = entities.filter((entitie) => {\r\n        return entitie.loc.address.toUpperCase().includes(address) && capacity <= entitie.capacity;\r\n    })\r\n    return filteredEntities\r\n}\r\n\r\nfunction get(entityType, entityId) {\r\n    return query(entityType)\r\n        .then(entities => entities.find(entity => entity._id === entityId))\r\n}\r\n\r\nfunction post(entityType, newEntity) {\r\n    newEntity._id = _makeId()\r\n    return query(entityType)\r\n        .then(entities => {\r\n            entities.push(newEntity)\r\n            _save(entityType, entities)\r\n            return newEntity\r\n        })\r\n}\r\n\r\nfunction put(entityType, updatedEntity) {\r\n    return query(entityType)\r\n        .then(entities => {\r\n            const idx = entities.findIndex(entity => entity._id === updatedEntity._id)\r\n            entities.splice(idx, 1, updatedEntity)\r\n            _save(entityType, entities)\r\n            return updatedEntity\r\n        })\r\n}\r\n\r\nfunction remove(entityType, entityId) {\r\n    return query(entityType)\r\n        .then(entities => {\r\n            const idx = entities.findIndex(entity => entity._id === entityId)\r\n            entities.splice(idx, 1)\r\n            _save(entityType, entities)\r\n        })\r\n}\r\n\r\n\r\nfunction _save(entityType, entities) {\r\n    localStorage.setItem(entityType, JSON.stringify(entities))\r\n}\r\n\r\nfunction _makeId(length = 5) {\r\n    var text = ''\r\n    var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'\r\n    for (var i = 0; i < length; i++) {\r\n        text += possible.charAt(Math.floor(Math.random() * possible.length))\r\n    }\r\n    return text\r\n}"]},"metadata":{},"sourceType":"module"}